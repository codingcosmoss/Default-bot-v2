import{_ as w,o as u,c,a as e,e as d,w as m,h as I,r as h,I as V,n as b,t as o,b as f,g as y,u as z,A as _,bJ as F,l as S,a2 as R,bk as q,bv as J,aX as U,F as v,f as P,d as G}from"./app--lA0zENz.js";import{a as E,M as j}from"./Page-kS-htxF1.js";import{D as N}from"./DefaultSelect-uFn2hizB.js";import{P as x}from"./PrimaryIconBtn-zZrE_wsa.js";import{D as k}from"./DefaultIconInput-VTCAHB3z.js";import{a as H,B as Q}from"./BasicTable-ceqsBAou.js";import{D as X}from"./DefaultInput-OXMKtQjk.js";import{B as Y}from"./BasicInput-y6ZnW6eW.js";import{S as K}from"./sweetalert2.all-IKh5fYv4.js";import{C as W}from"./create-gVLqG_LI.js";import"./ImageInput-q8VLym8J.js";const Z={components:{BtnBox:H,PrimaryBtn:E,DefaultIconInput:k,PrimaryIconBtn:x,DefaultSelect:N},data(){return{searchMedicines:[],loader:!1}},methods:{}},tt={class:"d-xl-flex selling_box selling_box1"},et={class:"w-100"},st={class:"d-md-flex selling_md_flex"},nt={class:"w-100"},ot={class:"card"},rt={class:"card-body selling_item_list position-relative"},lt={class:"p-3 pt-2 pb-0 bg-primary selling_search_box"},it={class:"d-flex flex-row col-12"},at=e("i",{class:"bx bx-search-alt-2"},null,-1),ut={class:"card w-100 me-md-3"},ct={class:"card-body p-0"},dt={class:"row p-3"},mt={class:"col-xl-8 col-lg-8 col-md-10 col-sm-8 d-flex align-items-start gap-3"},ht={class:"col-xl-4 col-lg-4 col-md-2 col-sm-4 d-flex gap-2"},gt={class:"selling_left_table"},_t={class:"selling_main"};function pt(t,s,r,i,n,a){const g=h("DefaultIconInput"),A=h("PrimaryIconBtn"),T=h("BtnBox");return u(),c("div",tt,[e("div",et,[e("div",st,[e("div",nt,[e("div",ot,[e("div",rt,[e("div",lt,[e("div",it,[d(g,{Label:"",class:"selling_input",inputClass:"p-2",Class:"col-lg-6 col-md-12 col-xl-8 col-sm-12",Pholder:t.$t("SearchMedicines")+"...",onOnInput:s[0]||(s[0]=C=>this.$emit("onSearch",C))},{default:m(()=>[at]),_:1},8,["Pholder"])])]),I(t.$slots,"default")])])]),e("div",ut,[e("div",ct,[e("div",dt,[e("div",mt,[I(t.$slots,"customers")]),e("div",ht,[d(T,null,{default:m(()=>[d(A,{onClick:s[1]||(s[1]=C=>this.$router.push("/admin/archive/invoices")),Icon:"bx bx-log-in-circle font-size-20",title:t.$t("Home")},null,8,["title"])]),_:1})])]),e("div",gt,[I(t.$slots,"left")])])])])]),e("div",_t,[I(t.$slots,"main")])])}const ft=w(Z,[["render",pt]]),bt={props:{Amount:{Number},Title:{String},Text:{String},Image:{String}},methods:{truncateText(t){return t.length>60?t.substring(0,45)+"...":t}}},yt={class:"col-sm-4 col-md-6 col-lg-4 col-xl-3 p-2 cursor-pointer waves-effect waves-light"},St={class:"card-body text-center",style:{padding:"5px"}},vt={class:"card-title font-size-13"},Ct={class:"card-text font-size-12"};function Mt(t,s,r,i,n,a){const g=h("font");return u(),c("div",yt,[e("div",{class:b(["card m-0 selling_card_box border border-primary",r.Amount>0?"border-primary":"border-danger opacity-50 disabled not_amount"])},[e("div",{class:"selling_card_img bg-warning-subtle",style:V("background-image: url("+r.Image+")")},null,4),e("div",{class:b(["selling_qty p-1 btn waves-effect waves-light",r.Amount>0?"btn-primary":"btn-danger"])},"QTY: "+o(r.Amount),3),e("div",St,[e("h4",vt,[d(g,{style:{"vertical-align":"inherit"}},{default:m(()=>[d(g,{style:{"vertical-align":"inherit"}},{default:m(()=>[f(o(r.Title),1)]),_:1})]),_:1})]),e("p",Ct,[d(g,{style:{"vertical-align":"inherit"}},{default:m(()=>[d(g,{style:{"vertical-align":"inherit"}},{default:m(()=>[f(o(a.truncateText(r.Text)),1)]),_:1})]),_:1})])])],2)])}const It=w(bt,[["render",Mt]]),Pt={props:{Class:{type:String,default:"col-lg-12 col-sm-12"},inputClass:{type:String,default:""},Name:{type:[String],default:""},Label:{type:String,default:"Label title"},Pholder:{type:String,default:"enter here..."},Type:{type:String,default:"text"},Value:{type:[String,Number],default:""},isError:{type:Boolean,default:!1}}},wt={key:0,class:"form-label"},At={class:"input-group bootstrap-touchspin bootstrap-touchspin-injected"},Tt={class:"input-group-btn input-group-prepend"},Et=["type","value","placeholder"],Nt={class:"input-group-btn input-group-append"};function xt(t,s,r,i,n,a){return u(),c("div",{class:b(r.Class)},[e("div",null,[r.Label!=""?(u(),c("label",wt,o(r.Label),1)):y("",!0),e("div",At,[e("span",Tt,[e("button",{class:b([r.isError?"border-danger ":"","btn btn-primary bootstrap-touchspin-down"]),onClick:s[0]||(s[0]=g=>this.$emit("onMinus",!0)),type:"button"},"âˆ’",2)]),e("input",{class:b(["form-control",r.isError?"border-danger "+r.inputClass:r.inputClass]),type:r.Type,value:r.Value,placeholder:r.Pholder,onInput:s[1]||(s[1]=g=>this.$emit("onInput",g.target.value))},null,42,Et),e("span",Nt,[e("button",{class:b([r.isError?"border-danger ":"","btn btn-primary bootstrap-touchspin-up"]),onClick:s[2]||(s[2]=g=>this.$emit("onPlus",!0)),type:"button"},"+",2)])])])],2)}const kt=w(Pt,[["render",xt]]),Bt={components:{ModalCentered:j,DefaultSelect:N,PrimaryBtn:E,DefaultIconInput:k,PrimaryIconBtn:x,AmountInput:kt,BasicInput:Y,DefaultInput:X,BasicTable:Q,SellingCard:It,Layout:ft,CustomerCreate:W},setup(){return{counterStore:z()}},data(){return{items:[],item:[],paginateCount:10,last_page:1,current_page:1,column:"id",type:"desc",errors:[],headers:[],searchMedicines:[],sellingMedicines:[],sortId:0,loader:!1,sign:"",subtotal:0,gst:0,igta:0,inputErrors:[],gstResult:0,customer:{id:0,name:"---"},customers:[],amount_due:0,cashPaymentLoader:!1,paymentTypesArr:[]}},methods:{onClickSong(){let t=document.querySelector(".onClickSong");t.paused||(t.pause(),t.currentTime=0),t.play()},onErrorSong(){let t=document.querySelector(".onErrorSong");t.paused||(t.pause(),t.currentTime=0),t.play()},onSuccessSong(){K.fire({title:this.$t("Successfully"),text:"",icon:"success"});let t=document.querySelector(".onSuccessSong");t.paused||(t.pause(),t.currentTime=0),t.play()},dataRefresh(){this.sellingMedicines=[],this.subtotal=0,this.igta=0,this.gst=0,this.amount_due=0},async cashPayment(t=null){try{if(this.cashPaymentLoader=!0,this.customer.id==0)return this.onErrorSong(),this.errors.customer=this.$t("CustomerValidated"),_("error",this.$t("CustomerValidated")),this.cashPaymentLoader=!1,!1;if(this.amount_due>this.resultSum())return this.onErrorSong(),_("error",this.$t("PaymentMaxError")),this.cashPaymentLoader=!1,!1;if(this.sellingMedicines.length==0)return this.onErrorSong(),_("error",this.$t("MedicinesValidated")),this.cashPaymentLoader=!1,!1;let s=0;this.sellingMedicines.forEach(a=>{s+=a.selling_amount});let r=null;t==null?r=this.paymentTypesArr.find(a=>a.status==9).id:r=t;let i={customer_id:this.customer.id,amount:s,amount_paid:this.amount_due,must_paid:this.resultSum()-this.amount_due,subtotal:this.resultSum(),igta:this.igta,gst:this.gst,medicines:this.sellingMedicines,currency_id:this.counterStore.user.currency.id,payment_type_id:r};const n=await F(i);return n.status?(this.counterStore.hiddenModal("changePayment"),this.dataRefresh(),this.onSuccessSong(),this.indexPaginates(),this.cashPaymentLoader=!1,!0):(this.errors=n.errors,_("error",this.$t("formError")),this.cashPaymentLoader=!1,!1)}catch(s){return S(this,s),this.cashPaymentLoader=!1,!1}},resultSum(){return this.subtotal+this.igta+this.gstResult},sellingAmount(t){let s=this.counterStore.inputNumberFormat("amount_due",this.amount_due,t);this.amount_due=s},gstCalculator(){this.gstResult=this.subtotal*this.gst/100},changeItemAmount(t,s){let r=this.sellingMedicines[t];r.amount<s?(this.onErrorSong(),_("error",this.$t("MedicineNotAmount")),this.inputErrors.push(r.id)):(this.inputErrors=this.inputErrors.filter(i=>i!=r.id),this.sellingMedicines[t].selling_amount=s)},sumAmount(){let t=0;return this.sellingMedicines.forEach(s=>{t+=s.price*s.selling_amount}),this.subtotal=t,this.gstCalculator(),Number(t)},sumIgta(){let t=0;return this.sellingMedicines.forEach(s=>{t+=s.igta*s.selling_amount}),this.igta=t,Number(t)},onDelete(t){this.sellingMedicines=this.sellingMedicines.filter(s=>s.sortId!=t),this.sumAmount()},async indexCustomers(){try{const t=await R();this.customers=t.data}catch(t){S(this,t)}},async indexPaymentTypes(){try{const t=await q();this.paymentTypesArr=t.data}catch(t){S(this,t)}},changeAmount(t,s,r=1){let i=this.sellingMedicines[s];if(t=="plus"){if(i.amount<i.selling_amount+r)return this.onErrorSong(),_("error",this.$t("MedicineNotAmount")),!1;this.sellingMedicines[s].selling_amount+=r,this.inputErrors=this.inputErrors.filter(n=>n!=i.sortId)}else{if(0>i.selling_amount-r)return this.onErrorSong(),!1;this.sellingMedicines[s].selling_amount-=r,this.inputErrors=this.inputErrors.filter(n=>n!=i.id)}},addMedicines(t){if(this.onClickSong(),this.realAmount(t)<=0)return _("error",this.$t("MedicineNotAmount")),!1;let s=this.sellingMedicines.findIndex(n=>n.id==t.id);if(s!=-1)return this.sellingMedicines[s].selling_amount+=1,this.sumAmount(),!0;let r=this.sortId+1,i={...t};i.sortId=r,i.selling_amount=1,this.sortId=r,this.sellingMedicines.push(i),this.sumAmount()},realAmount(t){let s=this.sellingMedicines.find(r=>r.id==t.id);return s?t.amount-s.selling_amount:t.amount},async search(t=""){try{if(this.loader=!0,this.searchMedicines=[],t=="")return this.indexPaginates(),!0;const s=await J(t);return this.searchMedicines=s.data,this.loader=!1,s.status?(this.loader=!1,!0):(_("error",this.$t("formError")),this.loader=!1,!1)}catch(s){return S(this,s),this.loader=!1,!1}},async indexPaginates(t=1){try{this.sign=this.counterStore.user.currency.sign,this.loader=!0;const s=await U(10,t);this.searchMedicines=s.data.items,this.loader=!1}catch(s){S(this,s)}}},mounted(){this.indexPaginates(),this.indexCustomers(),this.indexPaymentTypes()}},Lt=["value"],$t=["value"],Dt={key:0,type:"button",role:"button","data-bs-toggle":"modal","data-bs-target":"#customerCreate",class:"btn btn-primary waves-effect waves-light"},Ot={class:"main_list"},Vt={class:"font-size-15"},zt={class:"font-size-20 fw-bold"},Ft={class:"font-size-15"},Rt=["value"],qt={class:"font-size-15"},Jt={key:0,class:"m-0"},Ut={key:1,class:"spinner-border text-success spinner-grow-sm m-4 mt-0 mb-0",role:"status"},Gt={type:"button","data-bs-toggle":"modal","data-bs-target":"#changePayment",class:"selling_btn btn btn-success waves-effect waves-light"},jt={class:"row p-4 pt-0 w-100"},Ht={class:"col-xl-6 col-lg-6"},Qt={class:"card-title mb-4"},Xt={class:"text-bg-primary p-1"},Yt={class:"table-responsive"},Kt={class:"table table-nowrap mb-0"},Wt={scope:"row"},Zt={scope:"row",class:"pt-3"},te={scope:"row"},ee={scope:"row"},se={scope:"row"},ne=e("br",null,null,-1),oe={class:"row p-2 selling_item_box position-relative"},re={key:0,class:"text-center p-3"},le={key:1,class:"selling_loader_box"},ie=e("div",{class:"spinner-border text-primary m-1",role:"status"},[e("span",{class:"sr-only"},"Loading...")],-1),ae=[ie],ue=["src"],ce=["src"],de=["src"],me=["onClick"];function he(t,s,r,i,n,a){const g=h("DefaultSelect"),A=h("AmountInput"),T=h("PrimaryIconBtn"),C=h("BasicTable"),B=h("DefaultIconInput"),L=h("SellingCard"),$=h("ModalCentered"),D=h("Layout"),O=h("CustomerCreate");return u(),c(v,null,[d(D,{onOnSearch:s[5]||(s[5]=l=>a.search(l))},{customers:m(()=>[d(g,{Label:"",Name:"customer",Class:"col-6",Validated:n.errors,onOnInput:s[0]||(s[0]=l=>(n.customer=JSON.parse(l),delete this.errors.customer))},{default:m(()=>[e("option",{selected:"",value:JSON.stringify({name:"---",id:0})},o(t.$t("Customers")),9,Lt),(u(!0),c(v,null,P(n.customers,l=>(u(),c("option",{value:JSON.stringify(l)},o(l.name),9,$t))),256))]),_:1},8,["Validated"]),i.counterStore.hasRole("Customers-create")?(u(),c("button",Dt,o(t.$t("CreateCustomer")),1)):y("",!0)]),main:m(()=>[e("ul",Ot,[e("li",Vt,[f(o(t.$t("Subtotal"))+": ",1),e("span",zt,o(i.counterStore.formatNumber(a.resultSum()))+" "+o(n.sign),1)]),e("li",Ft,[f(o(t.$t("PaidAmount"))+": ",1),e("input",{type:"text",value:i.counterStore.formatNumber(n.amount_due),class:"amount_due selling_amount",onInput:s[1]||(s[1]=l=>a.sellingAmount(l.target.value))},null,40,Rt)]),e("li",qt,[f(o(t.$t("AmountToPaid"))+": ",1),e("span",{class:b([a.resultSum()-n.amount_due<0?"text-bg-danger":"","font-size-20 fw-bold"])},o(i.counterStore.formatNumber(a.resultSum()-n.amount_due))+" "+o(n.sign),3)])]),e("button",{onClick:s[2]||(s[2]=l=>n.amount_due=a.resultSum()),type:"button",class:"selling_btn btn bg_color_yello waves-effect waves-light"},o(t.$t("FullPaid")),1),e("button",{onClick:s[3]||(s[3]=l=>a.cashPayment()),type:"button",class:"selling_btn btn btn-success waves-effect waves-light"},[n.cashPaymentLoader?y("",!0):(u(),c("p",Jt,o(t.$t("CashPayment")),1)),n.cashPaymentLoader?(u(),c("div",Ut)):y("",!0)]),e("button",Gt,o(t.$t("MFSPayment")),1)]),left:m(()=>[d(C,{Title:"",Th:[t.$t("No"),t.$t("MedicineName"),t.$t("Amount"),t.$t("Price"),t.$t("Total"),""],Col:"col-lg-12"},{default:m(()=>[(u(!0),c(v,null,P(n.sellingMedicines,(l,p)=>(u(),c("tr",null,[e("td",null,o(p+1),1),e("td",null,o(l.name),1),e("td",null,[d(A,{Label:"",inputClass:"selling_amount_input",Name:l.id,Pholder:"",Type:"number",isError:n.inputErrors.includes(l.id),Value:n.sellingMedicines[p].selling_amount,onOnInput:M=>a.changeItemAmount(p,M),onOnPlus:M=>a.changeAmount("plus",p),onOnMinus:M=>a.changeAmount("minus",p)},null,8,["Name","isError","Value","onOnInput","onOnPlus","onOnMinus"])]),e("td",null,o(i.counterStore.formatNumber(l.price))+" "+o(l.currency.sign),1),e("td",null,o(i.counterStore.formatNumber(l.price*l.selling_amount))+" "+o(l.currency.sign),1),e("td",null,[d(T,{onClick:M=>(a.onDelete(l.sortId),a.gstCalculator()),class:"bg-danger border-danger",Icon:"bx bx-trash-alt"},null,8,["onClick"])])]))),256))]),_:1},8,["Th"]),e("div",jt,[e("div",Ht,[e("h4",Qt,[f(o(t.$t("Customer"))+" : ",1),e("span",Xt,o(n.customer.name),1)]),e("div",Yt,[e("table",Kt,[e("tbody",null,[e("tr",null,[e("th",Wt,o(t.$t("Total"))+" :",1),e("td",null,o(i.counterStore.formatNumber(a.sumAmount()))+" "+o(n.sign),1)]),e("tr",null,[e("th",Zt,o(t.$t("GST/TaxAmount"))+" % :",1),e("td",null,[d(B,{Label:"",Value:n.gst,onOnInput:s[4]||(s[4]=l=>(n.gst=l,a.gstCalculator()))},{default:m(()=>[f(" % ")]),_:1},8,["Value"])])]),e("tr",null,[e("th",te,o(t.$t("IGTA"))+" :",1),e("td",null,o(i.counterStore.formatNumber(a.sumIgta()))+" "+o(n.sign),1)]),e("tr",null,[e("th",ee,o(t.$t("Subtotal"))+" :",1),e("td",null,o(i.counterStore.formatNumber(n.subtotal+n.igta+n.gstResult))+" "+o(n.sign),1)]),e("tr",null,[e("th",se,o(t.$t("AmountPaid"))+" :",1),e("td",null,o(i.counterStore.formatNumber(n.amount_due))+" "+o(n.sign),1)])])]),ne])])])]),default:m(()=>[e("div",oe,[(u(!0),c(v,null,P(n.searchMedicines,l=>(u(),G(L,{Title:l.name,Text:l.generic_name,Amount:a.realAmount(l),Image:l.image[0].url,onClick:p=>a.addMedicines(l)},null,8,["Title","Text","Amount","Image","onClick"]))),256)),!n.loader&&n.searchMedicines.length==0?(u(),c("div",re,[e("p",null,o(t.$t("MedicinesNotFount")),1)])):y("",!0),n.loader?(u(),c("div",le,ae)):y("",!0)]),e("audio",{class:"onClickSong",src:i.counterStore.baseUrl+"/Songs/click.mp3"},null,8,ue),e("audio",{class:"onErrorSong",src:i.counterStore.baseUrl+"/Songs/error.mp3"},null,8,ce),e("audio",{class:"onSuccessSong",src:i.counterStore.baseUrl+"/Songs/success.mp3"},null,8,de),d($,{ModalName:"changePayment",isModalFooter:!1,Title:t.$t("MFSPayments")},{default:m(()=>[(u(!0),c(v,null,P(n.paymentTypesArr,l=>(u(),c("button",{type:"button",class:"btn btn-secondary btn-rounded waves-effect waves-light",style:{"margin-right":"10px"},onClick:p=>a.cashPayment(l.id)},o(l.name),9,me))),256))]),_:1},8,["Title"])]),_:1}),d(O,{onOnCreate:a.indexCustomers},null,8,["onOnCreate"])],64)}const Pe=w(Bt,[["render",he]]);export{Pe as default};
