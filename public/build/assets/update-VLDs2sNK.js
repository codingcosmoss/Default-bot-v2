import{a as v,P as E}from"./Page-FAX3c1D0.js";import{_ as S,Q as L,u as V,S as x,l as m,K as N,M as I,A as u,N as M,d as P,w as o,r as a,o as d,a as c,e as r,b as f,t as _,c as C,f as $,F as g}from"./app-vet2y67C.js";import{a as U,B as q}from"./BasicTable-V7p4lhVL.js";import{G as F,P as G}from"./GrowingLoader-WhvMV74Z.js";import{D as K}from"./DefaultInput-9R5fBSGy.js";import{P as O}from"./PrimaryTable-jKC4oJ7u.js";const Q={components:{BaseCheck:L,PrimaryTable:O,BtnBox:U,DefaultInput:K,PrimaryBtn:v,GrowingLoader:F,PrimaryIconBtn:G,BasicTable:q,Page:E},setup(){return{counterStore:V()}},data(){return{items:[],item:[],paginateCount:10,column:"id",type:"desc",errors:[],loader:!1,menus:[],permissions:[],isAll:!1,name:""}},methods:{async index(){try{this.loader=!0;const s=await x();this.items=s.data,this.loader=!1}catch(s){m(this,s)}},async show(s){try{const e=await N(this.$route.query.id);this.item=e.data,this.name=e.data.name,console.log("Permissions:",e.data.permissions.length),e.data.permissions.forEach(t=>{this.permissions.push(t.id),this.menus.push(t.menu_id)})}catch(e){m(this,e)}},async create(){try{this.loader=!0;let s={name:this.name,permissions:this.permissions};const e=await I(s);return e.status?(u("success",this.$t("create")),this.loader=!1,this.$router.push("/admin/roles"),!0):(this.errors=e.errors,this.loader=!1,u("error",this.$t("formError")),!1)}catch(s){return m(this,s),this.loader=!1,!1}},async update(){try{this.loader=!0;let s={name:this.name,permissions:this.permissions};const e=await M(this.$route.query.id,s);return console.log(e),e.status?(this.$router.push("/admin/roles"),u("success",this.$t("update")),this.loader=!1,!0):(this.errors=e.errors,u("error",this.$t("formError")),this.loader=!1,!1)}catch(s){return m(this,s),this.loader=!1,!1}},addPermission(s){this.permissions.find(t=>t==s.id)?this.permissions=this.permissions.filter(t=>t!=s.id):(this.menus.push(s.menu_id),this.permissions.push(s.id))},addAllPermission(){this.isAll=!this.isAll,this.isAll?(this.menus=[],this.permissions=[],this.items.forEach(s=>{this.menus.push(s.id),s.permissions.forEach(e=>{this.permissions.push(e.id)})})):(this.menus=[],this.permissions=[]),console.log(this.permissions)},addMenu(s){this.menus.find(t=>t==s.id)?(this.menus=this.menus.filter(t=>t!=s.id),this.permissions=this.permissions.filter(t=>!s.permissions.find(B=>B.id==t))):(this.menus.push(s.id),s.permissions.forEach(t=>{this.permissions.includes(t.id)||this.permissions.push(t.id)}))}},mounted(){this.index(),this.show()}},R={class:"row"},j=c("br",null,null,-1),z={class:"text-primary"};function H(s,e,t,B,n,h){const w=a("DefaultInput"),y=a("PrimaryBtn"),A=a("BtnBox"),T=a("BaseBox"),p=a("BaseCheck"),b=a("PrimaryTable"),D=a("Page");return d(),P(D,{Title:""},{default:o(()=>[c("div",R,[r(T,{Col:"col-xl-6",Title:s.$t("Update")},{default:o(()=>[r(w,{Label:s.$t("RoleName"),Name:"name",Type:"text",Validated:n.errors,Value:n.name,onOnInput:e[0]||(e[0]=i=>(n.name=i,delete this.errors.name))},null,8,["Label","Validated","Value"]),r(A,null,{default:o(()=>[r(y,{class:"btn btn-secondary",onClick:e[1]||(e[1]=i=>this.$router.go(-1))},{default:o(()=>[f(_(s.$t("Close")),1)]),_:1}),f("   "),r(y,{onClick:e[2]||(e[2]=i=>h.update()),Loader:n.loader},{default:o(()=>[f(_(s.$t("Save")),1)]),_:1},8,["Loader"])]),_:1})]),_:1},8,["Title"]),r(T,{Col:"col-xl-6",Title:s.$t("Permissions")},{default:o(()=>[r(p,{onClick:e[3]||(e[3]=i=>h.addAllPermission()),isCheck:n.isAll,Title:s.$t("MarkAll")},null,8,["isCheck","Title"]),j,r(b,{Th:[s.$t("Sections"),s.$t("Permissions")],Title:"Latest Transaction",Col:"col-lg-12"},{default:o(()=>[(d(!0),C(g,null,$(n.items,i=>(d(),C("tr",null,[c("td",null,[r(p,{Title:s.$t(i.name),onClick:l=>h.addMenu(i),isCheck:this.menus.find(l=>l==i.id)},null,8,["Title","onClick","isCheck"])]),c("td",z,[(d(!0),C(g,null,$(i.permissions,l=>(d(),P(p,{onClick:k=>h.addPermission(l),isCheck:this.permissions.find(k=>k==l.id),Title:s.$t(l.name.toUpperCase())},null,8,["onClick","isCheck","Title"]))),256))])]))),256))]),_:1},8,["Th"])]),_:1},8,["Title"])])]),_:1})}const es=S(Q,[["render",H]]);export{es as default};
