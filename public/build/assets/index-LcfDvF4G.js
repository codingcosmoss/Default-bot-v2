import{_ as w,o as u,b as c,e as s,a as d,w as m,j as I,r as g,a0 as z,n as p,t as o,i as y,g as S,M as q,u as R,A as b,c0 as J,J as v,ak as j,c1 as U,bV as G,bd as H,I as Q,F as M,d as C,c as Y}from"./app-NOWLkVVR.js";import{a as N}from"./Page-WY9jM6QH.js";import{D as E}from"./DefaultSelect-M0WKtz1z.js";import{P as B}from"./PrimaryIconBtn-iSQma8Yq.js";import{D as k}from"./DefaultIconInput-2n9-V-5W.js";import{a as K,B as W}from"./BasicTable-BPH9PCc1.js";import{D as X}from"./DefaultInput-3ATS3cy3.js";import{B as Z,a as tt}from"./BasicSelect-wpRmcOIs.js";import{S as T}from"./sweetalert2.all-8l22AQZ-.js";import{C as et}from"./create-K4-Mvj0O.js";import"./ImageInput-NsZZ0EJH.js";const st={components:{BtnBox:K,PrimaryBtn:N,DefaultIconInput:k,PrimaryIconBtn:B,DefaultSelect:E},data(){return{searchMedicines:[],loader:!1}},methods:{}},nt={class:"d-xl-flex selling_box selling_box1"},it={class:"w-100"},ot={class:"d-md-flex selling_md_flex"},rt={class:"w-100"},lt={class:"card"},at={class:"card-body selling_item_list position-relative"},ut={class:"p-3 pt-2 pb-0 bg-primary selling_search_box"},ct={class:"d-flex flex-row col-12"},dt=s("i",{class:"bx bx-search-alt-2"},null,-1),mt={class:"card w-100 me-md-3"},ht={class:"card-body p-0"},gt={class:"row p-3"},_t={class:"col-xl-8 col-lg-8 col-md-10 col-sm-8 d-flex align-items-start gap-3"},ft={class:"col-xl-4 col-lg-4 col-md-2 col-sm-4 d-flex gap-2"},pt={class:"selling_left_table"},bt={class:"selling_main"};function yt(t,e,n,r,i,a){const h=g("DefaultIconInput"),P=g("PrimaryIconBtn"),A=g("BtnBox");return u(),c("div",nt,[s("div",it,[s("div",ot,[s("div",rt,[s("div",lt,[s("div",at,[s("div",ut,[s("div",ct,[d(h,{Label:"",class:"selling_input",inputClass:"p-2",Class:"col-lg-6 col-md-12 col-xl-8 col-sm-12",Pholder:t.$t("SearchMedicines")+"...",onOnInput:e[0]||(e[0]=x=>this.$emit("onSearch",x))},{default:m(()=>[dt]),_:1},8,["Pholder"])])]),I(t.$slots,"default")])])]),s("div",mt,[s("div",ht,[s("div",gt,[s("div",_t,[I(t.$slots,"customers")]),s("div",ft,[d(A,null,{default:m(()=>[d(P,{onClick:e[1]||(e[1]=x=>this.$router.push("/admin/archive/invoices")),Icon:"bx bx-log-in-circle font-size-20",title:t.$t("Home")},null,8,["title"])]),_:1})])]),s("div",pt,[I(t.$slots,"left")])])])])]),s("div",bt,[I(t.$slots,"main")])])}const St=w(st,[["render",yt]]),vt={props:{Amount:{Number},Title:{String},Text:{String},Image:{String}},methods:{truncateText(t){return t.length>60?t.substring(0,45)+"...":t}}},Mt={class:"col-sm-4 col-md-6 col-lg-4 col-xl-3 p-2 cursor-pointer waves-effect waves-light"},Ct={class:"card-body text-center",style:{padding:"5px"}},It={class:"card-title font-size-13"},wt={class:"card-text font-size-12"};function xt(t,e,n,r,i,a){const h=g("font");return u(),c("div",Mt,[s("div",{class:p(["card m-0 selling_card_box border border-primary",n.Amount>0?"border-primary":"border-danger opacity-50 disabled not_amount"])},[s("div",{class:"selling_card_img bg-warning-subtle",style:z("background-image: url("+n.Image+")")},null,4),s("div",{class:p(["selling_qty p-1 btn waves-effect waves-light",n.Amount>0?"btn-primary":"btn-danger"])},"QTY: "+o(n.Amount),3),s("div",Ct,[s("h4",It,[d(h,{style:{"vertical-align":"inherit"}},{default:m(()=>[d(h,{style:{"vertical-align":"inherit"}},{default:m(()=>[y(o(n.Title),1)]),_:1})]),_:1})]),s("p",wt,[d(h,{style:{"vertical-align":"inherit"}},{default:m(()=>[d(h,{style:{"vertical-align":"inherit"}},{default:m(()=>[y(o(a.truncateText(n.Text)),1)]),_:1})]),_:1})])])],2)])}const Pt=w(vt,[["render",xt]]),At={props:{Class:{type:String,default:"col-lg-12 col-sm-12"},inputClass:{type:String,default:""},Name:{type:[String],default:""},Label:{type:String,default:"Label title"},Pholder:{type:String,default:"enter here..."},Type:{type:String,default:"text"},Value:{type:[String,Number],default:""},isError:{type:Boolean,default:!1}}},Tt={key:0,class:"form-label"},Nt={class:"input-group bootstrap-touchspin bootstrap-touchspin-injected"},Et={class:"input-group-btn input-group-prepend"},Bt=["type","value","placeholder"],kt={class:"input-group-btn input-group-append"};function Lt(t,e,n,r,i,a){return u(),c("div",{class:p(n.Class)},[s("div",null,[n.Label!=""?(u(),c("label",Tt,o(n.Label),1)):S("",!0),s("div",Nt,[s("span",Et,[s("button",{class:p([n.isError?"border-danger ":"","btn btn-primary bootstrap-touchspin-down"]),onClick:e[0]||(e[0]=h=>this.$emit("onMinus",!0)),type:"button"},"âˆ’",2)]),s("input",{class:p(["form-control",n.isError?"border-danger "+n.inputClass:n.inputClass]),type:n.Type,value:n.Value,placeholder:n.Pholder,onInput:e[1]||(e[1]=h=>this.$emit("onInput",h.target.value))},null,42,Bt),s("span",kt,[s("button",{class:p([n.isError?"border-danger ":"","btn btn-primary bootstrap-touchspin-up"]),onClick:e[2]||(e[2]=h=>this.$emit("onPlus",!0)),type:"button"},"+",2)])])])],2)}const Vt=w(At,[["render",Lt]]),$t={props:{isButton:{type:Boolean,default:!1},Class:{type:String,default:"col-lg-12 col-sm-12"},ModalName:{type:String,default:"modal"},Name:{type:[String],default:""},Label:{type:String,default:"Label title"},Pholder:{type:String,default:"enter here..."},Type:{type:String,default:"text"},Value:{type:[String,Number],default:""},Validated:{type:[Array,Object,String],default:[]}}},Ot={key:0,class:"form-label"},Ft=["data-bs-target"];function Dt(t,e,n,r,i,a){return u(),c("div",{class:p(n.Class)},[s("div",null,[n.Label!=""?(u(),c("label",Ot,[y(o(n.Label)+" ",1),n.isButton?(u(),c("a",{key:0,class:"btn btn-primary waves-effect waves-light",role:"button","data-bs-toggle":"modal","data-bs-target":"#"+n.ModalName,style:{padding:"0px 5px","font-size":"10px"}},o(t.$t("Create")),9,Ft)):S("",!0)])):S("",!0),s("select",{class:p(["form-select",n.Validated[n.Name]?"border-danger":""]),onInput:e[0]||(e[0]=h=>this.$emit("onInput",h.target.value))},[I(t.$slots,"default")],34)])],2)}const zt=w($t,[["render",Dt]]),qt={components:{BasicSelect2:zt,BasicSelect:Z,ModalCentered:q,DefaultSelect:E,PrimaryBtn:N,DefaultIconInput:k,PrimaryIconBtn:B,AmountInput:Vt,BasicInput:tt,DefaultInput:X,BasicTable:W,SellingCard:Pt,Layout:St,CustomerCreate:et},setup(){return{counterStore:R()}},data(){return{items:[],item:[],searchText:"",paginateCount:10,last_page:1,current_page:1,column:"id",type:"desc",errors:[],headers:[],searchMedicines:[],sellingMedicines:[],sortId:0,loader:!1,sign:"",subtotal:0,gst:0,igta:0,inputErrors:[],gstResult:0,customer:{id:0,name:"---"},customers:[],amount_due:0,cashPaymentLoader:!1,paymentTypesArr:[]}},methods:{onBatch(t,e){e?(e=JSON.parse(e),this.sellingMedicines[t].batch_id=e.id,this.sellingMedicines[t].amount=e.amount,this.sellingMedicines[t].selling_amount=0,this.sellingMedicines[t].expiration_date=e.expiry_date_finished,this.changeAmount("plus",t)):(this.sellingMedicines[t].batch_id=null,this.sellingMedicines[t].amount=0,this.sellingMedicines[t].selling_amount=0,this.sellingMedicines[t].expiration_date="---")},onClickSong(){let t=document.querySelector(".onClickSong");t.paused||(t.pause(),t.currentTime=0),t.play()},onErrorSong(){let t=document.querySelector(".onErrorSong");t.paused||(t.pause(),t.currentTime=0),t.play()},onSuccessSong(){T.fire({title:this.$t("Successfully"),text:"",icon:"success"});let t=document.querySelector(".onSuccessSong");t.paused||(t.pause(),t.currentTime=0),t.play()},dataRefresh(){this.sellingMedicines=[],this.subtotal=0,this.igta=0,this.gst=0,this.amount_due=0},async cashPayment(t=null){try{if(this.cashPaymentLoader=!0,this.customer.id==0)return this.onErrorSong(),this.errors.customer=this.$t("CustomerValidated"),b("error",this.$t("CustomerValidated")),this.cashPaymentLoader=!1,!1;if(this.amount_due>this.resultSum())return this.onErrorSong(),b("error",this.$t("PaymentMaxError")),this.cashPaymentLoader=!1,!1;if(this.sellingMedicines.length==0)return this.onErrorSong(),b("error",this.$t("MedicinesValidated")),this.cashPaymentLoader=!1,!1;let e=0;this.sellingMedicines.forEach(a=>{e+=Number(a.selling_amount)});let n=null;t==null?n=this.paymentTypesArr.find(a=>a.status==9).id:n=t;let r={customer_id:this.customer.id,amount:e,amount_paid:this.amount_due,must_paid:this.resultSum()-this.amount_due,subtotal:this.resultSum(),igta:this.igta,gst:this.gst,medicines:this.sellingMedicines,currency_id:this.counterStore.user.currency.id,payment_type_id:n};const i=await J(r);return i.status?(this.counterStore.hiddenModal("changePayment"),this.dataRefresh(),this.onSuccessSong(),this.search(),this.cashPaymentLoader=!1,!0):(this.onErrorSong(),i.medicines.length>0?(this.amountErrorFix(i.medicines),!1):(this.errors=i.errors,this.cashPaymentLoader=!1,!1))}catch(e){return v(this,e),this.cashPaymentLoader=!1,!1}},async amountErrorFix(t){t.forEach(e=>{let n=this.sellingMedicines.findIndex(r=>r.id==e.id);this.sellingMedicines[n].selling_amount=e.amount,this.sellingMedicines[n].amount=e.amount,this.sellingMedicines[n].batches=e.batches,e.amount>0&&(this.sellingMedicines[n].batch_id=e.batches[0].id),this.inputErrors.push(e.id)}),this.amount_due=0,T.fire({title:this.$t("SellingError"),text:"",icon:"info"}),this.search(this.searchText),this.cashPaymentLoader=!1},resultSum(){let t=this.subtotal+this.igta+this.gstResult;return Math.round(t*100)/100},sellingAmount(t){let e=this.counterStore.inputNumberFormat("amount_due",this.amount_due,t);this.amount_due=e},gstCalculator(){this.gstResult=this.subtotal*this.gst/100},changeItemAmount(t,e){let n=this.sellingMedicines[t];n.amount<e?(this.onErrorSong(),b("error",this.$t("MedicineNotAmount")),this.inputErrors.push(n.id)):(this.inputErrors=this.inputErrors.filter(r=>r!=n.id),this.sellingMedicines[t].selling_amount=e)},sumAmount(){let t=0;return this.sellingMedicines.forEach(e=>{t+=e.price*e.selling_amount}),this.subtotal=t,this.gstCalculator(),Number(t)},sumIgta(){let t=0;return this.sellingMedicines.forEach(e=>{t+=e.igta*e.selling_amount}),this.igta=t,Number(t)},onDelete(t){this.sellingMedicines=this.sellingMedicines.filter(e=>e.sortId!=t),this.sumAmount()},async indexCustomers(){try{const t=await j();this.customers=t.data}catch(t){v(this,t)}},async indexPaymentTypes(){this.sign=this.counterStore.user.currency.sign;try{const t=await U();this.paymentTypesArr=t.data}catch(t){v(this,t)}},changeAmount(t,e,n=1){let r=this.sellingMedicines[e];if(r.batch_id==null||r.batch_id<1){this.errors["batch_id"+r.id]="error",b("error",this.$t("BatchValidated2"));return}if(t=="plus"){if(r.amount<r.selling_amount+n)return this.onErrorSong(),b("error",this.$t("MedicineNotAmount")),!1;this.sellingMedicines[e].selling_amount+=n,this.inputErrors=this.inputErrors.filter(i=>i!=r.sortId)}else{if(0>=r.selling_amount-n)return this.onErrorSong(),!1;this.sellingMedicines[e].selling_amount-=n,this.inputErrors=this.inputErrors.filter(i=>i!=r.id)}},addMedicines(t){if(this.onClickSong(),this.realAmount(t)<=0)return b("error",this.$t("MedicineNotAmount")),!1;let e=this.sellingMedicines.findIndex(i=>i.id==t.id);if(e!=-1)return this.changeAmount("plus",e),!0;let n=this.sortId+1,r={...t};r.sortId=n,r.selling_amount=1,r.expiration_date=t.batches[0].expiry_date_finished,r.batch_id=t.batches[0].id,r.amount=t.batches[0].amount,r.is_error=0,this.sortId=n,this.sellingMedicines.push(r),this.sumAmount()},realAmount(t){let e=this.sellingMedicines.find(n=>n.id==t.id);return e?t.amount-e.selling_amount:t.amount},async search(t=""){try{this.searchText=t,this.loader=!0,this.searchMedicines=[],this.searchText==""&&(this.searchText="all");const e=await G(this.searchText);return this.searchMedicines=e.data,this.loader=!1,e.status?(this.loader=!1,!0):(b("error",this.$t("formError")),this.loader=!1,!1)}catch(e){return v(this,e),this.loader=!1,!1}},async indexPaginates(t=1){try{this.sign=this.counterStore.user.currency.sign,this.loader=!0;const e=await H(10,t);this.searchMedicines=e.data.items,this.loader=!1}catch(e){v(this,e)}},async quantityVerification(){try{this.loader=!0,(await Q()).status&&await this.search(),this.loader=!1}catch(t){v(this,t)}}},mounted(){this.quantityVerification(),this.indexCustomers(),this.indexPaymentTypes()}},Rt=["value"],Jt=["value"],jt={key:0,type:"button",role:"button","data-bs-toggle":"modal","data-bs-target":"#customerCreate",class:"btn btn-primary waves-effect waves-light"},Ut={class:"main_list"},Gt={class:"font-size-15"},Ht={class:"font-size-20 fw-bold"},Qt={class:"font-size-15"},Yt=["value"],Kt={class:"font-size-15"},Wt={key:0,class:"m-0"},Xt={key:1,class:"spinner-border text-success spinner-grow-sm m-4 mt-0 mb-0",role:"status"},Zt={type:"button","data-bs-toggle":"modal","data-bs-target":"#changePayment",class:"selling_btn btn btn-success waves-effect waves-light"},te={class:"text-wrap font-size-10"},ee=["selected","value"],se={style:{"min-width":"130px"}},ne={class:"row p-4 pt-0 w-100"},ie={class:"col-xl-6 col-lg-6"},oe={class:"card-title mb-4"},re={class:"text-bg-primary p-1"},le={class:"table-responsive"},ae={class:"table table-nowrap mb-0"},ue={scope:"row"},ce={scope:"row",class:"pt-3"},de={scope:"row"},me={scope:"row"},he={scope:"row"},ge=s("br",null,null,-1),_e={class:"row p-2 selling_item_box position-relative"},fe={key:0,class:"text-center p-3"},pe={key:1,class:"selling_loader_box"},be=s("div",{class:"spinner-border text-primary m-1",role:"status"},[s("span",{class:"sr-only"},"Loading...")],-1),ye=[be],Se=["src"],ve=["src"],Me=["src"],Ce=["onClick"];function Ie(t,e,n,r,i,a){const h=g("DefaultSelect"),P=g("BasicSelect2"),A=g("AmountInput"),x=g("PrimaryIconBtn"),L=g("BasicTable"),V=g("DefaultIconInput"),$=g("SellingCard"),O=g("ModalCentered"),F=g("Layout"),D=g("CustomerCreate");return u(),c(M,null,[d(F,{onOnSearch:e[5]||(e[5]=l=>a.search(l))},{customers:m(()=>[d(h,{Label:"",Name:"customer",Class:"col-6",Validated:i.errors,onOnInput:e[0]||(e[0]=l=>(i.customer=JSON.parse(l),delete this.errors.customer))},{default:m(()=>[s("option",{selected:"",value:JSON.stringify({name:"---",id:0})},o(t.$t("Customers")),9,Rt),(u(!0),c(M,null,C(i.customers,l=>(u(),c("option",{value:JSON.stringify(l)},o(l.name),9,Jt))),256))]),_:1},8,["Validated"]),r.counterStore.hasRole("Customers-create")?(u(),c("button",jt,o(t.$t("CreateCustomer")),1)):S("",!0)]),main:m(()=>[s("ul",Ut,[s("li",Gt,[y(o(t.$t("Subtotal"))+": ",1),s("span",Ht,o(r.counterStore.formatNumber(a.resultSum().toFixed(2)))+" "+o(i.sign),1)]),s("li",Qt,[y(o(t.$t("PaidAmount"))+": ",1),s("input",{type:"text",value:r.counterStore.formatNumber(i.amount_due),class:"amount_due selling_amount",onInput:e[1]||(e[1]=l=>a.sellingAmount(l.target.value))},null,40,Yt)]),s("li",Kt,[y(o(t.$t("AmountToPaid"))+": ",1),s("span",{class:p([a.resultSum()-i.amount_due<0?"text-bg-danger":"","font-size-20 fw-bold"])},o(r.counterStore.formatNumber((a.resultSum()-i.amount_due).toFixed(2)))+" "+o(i.sign),3)])]),s("button",{onClick:e[2]||(e[2]=l=>i.amount_due=a.resultSum()),type:"button",class:"selling_btn btn bg_color_yello waves-effect waves-light"},o(t.$t("FullPaid")),1),s("button",{onClick:e[3]||(e[3]=l=>a.cashPayment()),type:"button",class:"selling_btn btn btn-success waves-effect waves-light"},[i.cashPaymentLoader?S("",!0):(u(),c("p",Wt,o(t.$t("CashPayment")),1)),i.cashPaymentLoader?(u(),c("div",Xt)):S("",!0)]),s("button",Zt,o(t.$t("MFSPayment")),1)]),left:m(()=>[d(L,{Title:"",Th:[t.$t("MedicineName"),t.$t("Batch"),t.$t("ExpiryDateFinished"),t.$t("Amount"),t.$t("Price"),t.$t("Total"),""],Col:"col-lg-12"},{default:m(()=>[(u(!0),c(M,null,C(i.sellingMedicines,(l,f)=>(u(),c("tr",null,[s("td",te,o(l.name),1),s("td",null,[d(P,{style:{"min-width":"100px"},Label:"",isButton:!0,Name:"batch_id"+l.id,Validated:i.errors,onOnInput:_=>a.onBatch(f,_)},{default:m(()=>[(u(!0),c(M,null,C(l.batches,_=>(u(),c("option",{selected:i.sellingMedicines[f].batch_id==_.id,value:JSON.stringify(_)},o(_.name)+" ("+o(_.amount)+") ",9,ee))),256))]),_:2},1032,["Name","Validated","onOnInput"])]),s("td",null,o(i.sellingMedicines[f].expiration_date),1),s("td",null,[s("div",se,[d(A,{Label:"",inputClass:"selling_amount_input ",Name:l.id,Pholder:"",Type:"number",isError:i.inputErrors.includes(l.id),Value:i.sellingMedicines[f].selling_amount,onOnInput:_=>a.changeItemAmount(f,_),onOnPlus:_=>a.changeAmount("plus",f),onOnMinus:_=>a.changeAmount("minus",f)},null,8,["Name","isError","Value","onOnInput","onOnPlus","onOnMinus"])])]),s("td",null,o(r.counterStore.formatNumber(l.price))+" "+o(l.currency.sign),1),s("td",null,o(r.counterStore.formatNumber((l.price*l.selling_amount).toFixed(2)))+" "+o(l.currency.sign),1),s("td",null,[d(x,{onClick:_=>(a.onDelete(l.sortId),a.gstCalculator()),class:"bg-danger border-danger",Icon:"bx bx-trash-alt"},null,8,["onClick"])])]))),256))]),_:1},8,["Th"]),s("div",ne,[s("div",ie,[s("h4",oe,[y(o(t.$t("Customer"))+" : ",1),s("span",re,o(i.customer.name),1)]),s("div",le,[s("table",ae,[s("tbody",null,[s("tr",null,[s("th",ue,o(t.$t("Total"))+" :",1),s("td",null,o(r.counterStore.formatNumber(a.sumAmount().toFixed(2)))+" "+o(i.sign),1)]),s("tr",null,[s("th",ce,o(t.$t("GST/TaxAmount"))+" % :",1),s("td",null,[d(V,{Label:"",Value:i.gst,onOnInput:e[4]||(e[4]=l=>(i.gst=l,a.gstCalculator()))},{default:m(()=>[y(" % ")]),_:1},8,["Value"])])]),s("tr",null,[s("th",de,o(t.$t("IGTA"))+" :",1),s("td",null,o(r.counterStore.formatNumber(a.sumIgta().toFixed(2)))+" "+o(i.sign),1)]),s("tr",null,[s("th",me,o(t.$t("Subtotal"))+" :",1),s("td",null,o(r.counterStore.formatNumber((i.subtotal+i.igta+i.gstResult).toFixed(2)))+" "+o(i.sign),1)]),s("tr",null,[s("th",he,o(t.$t("AmountPaid"))+" :",1),s("td",null,o(r.counterStore.formatNumber(i.amount_due.toFixed(2)))+" "+o(i.sign),1)])])]),ge])])])]),default:m(()=>[s("div",_e,[(u(!0),c(M,null,C(i.searchMedicines,l=>(u(),Y($,{Title:l.name,Text:l.generic_name,Amount:a.realAmount(l),Image:l.image[0].url,onClick:f=>a.addMedicines(l)},null,8,["Title","Text","Amount","Image","onClick"]))),256)),!i.loader&&i.searchMedicines.length==0?(u(),c("div",fe,[s("p",null,o(t.$t("MedicinesNotFount")),1)])):S("",!0),i.loader?(u(),c("div",pe,ye)):S("",!0)]),s("audio",{class:"onClickSong",src:r.counterStore.baseUrl+"/Songs/click.mp3"},null,8,Se),s("audio",{class:"onErrorSong",src:r.counterStore.baseUrl+"/Songs/error.mp3"},null,8,ve),s("audio",{class:"onSuccessSong",src:r.counterStore.baseUrl+"/Songs/success.mp3"},null,8,Me),d(O,{ModalName:"changePayment",isModalFooter:!1,Title:t.$t("MFSPayments")},{default:m(()=>[(u(!0),c(M,null,C(i.paymentTypesArr,l=>(u(),c("button",{type:"button",class:"btn btn-secondary btn-rounded waves-effect waves-light",style:{"margin-right":"10px"},onClick:f=>a.cashPayment(l.id)},o(l.name),9,Ce))),256))]),_:1},8,["Title"])]),_:1}),d(D,{onOnCreate:a.indexCustomers},null,8,["onOnCreate"])],64)}const $e=w(qt,[["render",Ie]]);export{$e as default};
