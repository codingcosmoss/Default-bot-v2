import{a as v,b as E,P as k}from"./Page-oy7_sxtd.js";import{_ as w,o as l,b as f,j as V,p as A,h as x,e as t,M as R,u as H,A as u,bH as z,J as c,bI as F,bJ as G,bC as O,c as _,w as m,r as i,a as d,d as U,t as n,a0 as q,g as y,F as j,i as J}from"./app-wtO1z4Rv.js";import{B as W}from"./BasicTable-KBZMgACR.js";import{G as Q}from"./GrowingLoader-TY1tKz0q.js";import{P as K}from"./PrimaryIconBtn-mvwMK-Pq.js";import{D as X}from"./DefaultInput-gYiX_NxV.js";import{P as Y}from"./Paginate-J6DCmPmv.js";import{D as Z}from"./DefaultSelect-EBZPnGtB.js";import{I as ee,H as te,R as re,S as oe}from"./IconSelect-t6hO5wHd.js";import{U as ne,C as g}from"./create-7R586yOC.js";import{D as se}from"./DefaultIconInput-6YZXookL.js";import{B as ae,a as ie}from"./BasicSelect-za3oP8sc.js";import{t as ue}from"./toPay-_7rDoL6b.js";import"./ImageInput-qMtb-DiA.js";import"./boxCreate-6hjav3wX.js";import"./boxCreate-U00nfpSj.js";import"./Loader-R7EGdjTq.js";const de={props:{Loader:{type:Boolean,default:!1},Modal:{type:String,default:"modal"}}},le=e=>(A("data-v-5e430008"),e=e(),x(),e),ce=["disabled","data-bs-target"],me={key:1,class:"spinner-border text-white m-1",role:"status"},he=le(()=>t("span",{class:"sr-only"},"Loading...",-1)),pe=[he];function _e(e,r,h,a,s,p){return l(),f("button",{disabled:h.Loader,type:"button","data-bs-toggle":"modal","data-bs-target":"#"+h.Modal,class:"btn btn-primary w-md"},[h.Loader?(l(),f("div",me,pe)):V(e.$slots,"default",{key:0},void 0,!0)],8,ce)}const fe=w(de,[["render",_e],["__scopeId","data-v-5e430008"]]),ye={components:{toPay:ue,PrimaryModalBtn:fe,BasicSelect:ae,BasicInput:ie,IconSelect:ee,DefaultIconInput:se,Update:ne,Create:g,DefaultSelect:Z,Paginate:Y,DefaultInput:X,PrimaryBtn:v,ModalCentered:R,PrimaryIconBtn:K,PrimaryButton:E,GrowingLoader:Q,BasicTable:W,Page:k,Header:te,Report:re,Search:oe,CreateMedicine:g},setup(){return{counterStore:H()}},data(){return{change:!1,isChange:!1,items:[],mloader:!1,item:[],boxItem:[],paginateCount:10,last_page:1,current_page:1,boxLast_page:1,boxCurrent_page:1,column:"id",type:"desc",loader:!1,boxLoader:!1,boxItems:[],medicines:[],document:[],sortId:1,paymentTypes:[],paid:0,subtotal:0,payment_type_id:null,dataErrors:[],amount:0,errors:[],returned_price:0,sign:""}},methods:{addPrice(e){let r=this.counterStore.inputNumberFormat("returned_price",this.returned_price,e);console.log("all",r),this.returned_price=r},async returnedMedicine(){try{if(this.loader=!0,this.amount==0&&this.returned_price==0)return this.errors.returned_amount=" ",this.errors.returned_price=" ",this.loader=!1,!0;if(this.item.amount<this.amount)return u("error",this.$t("ReturnedMaxError")),this.errors.returned_amount=this.$t("ReturnedMaxError"),this.loader=!1,!1;if(this.item.current_amount<this.amount)return u("error",this.$t("WarehouseNotLeft")),this.errors.returned_amount=this.$t("WarehouseNotLeft"),this.loader=!1,!1;if(this.document.amount_paid<this.returned_price)return u("error",this.$t("ReturnedAmountError")),this.errors.returned_price=this.$t("ReturnedAmountError"),this.loader=!1,!1;this.errors=[];let e={document_id:this.document.id,supplier_id:this.document.supplier_id,warehouse_id:this.document.warehouse_id,payment_type_id:this.payment_type_id,medicine:this.item,returned_amount:this.amount,returned_price:this.returned_price,currency_id:this.document.currency.id};const r=await z(e);if(r.status)return this.amount=0,this.show(),this.showDocument(),u("success",this.$t("ReturnedSuccess")),this.counterStore.hiddenModal("returnedModal"),this.loader=!1,!0;this.errors=r.errors,u("error",this.$t("formError")),this.loader=!1}catch(e){c(this,e)}},deleteError(e){this.isChange=!this.isChange,this.dataErrors=this.dataErrors.filter(r=>r!="date"+e&&r!="buy_price"+e&&r!="bu_amount"+e)},async show(){try{this.loader=!0;const e=await F(this.$route.query.id);this.medicines=e.data,this.loader=!1}catch(e){c(this,e)}},async showDocument(){try{const e=await G(this.$route.query.id);this.document=e.data,this.sign=e.data.currency.sign}catch(e){c(this,e)}},async indexPaymentTypes(){try{this.loader=!0;const e=await O();this.paymentTypes=e.data,this.loader=!1}catch(e){c(this,e)}},async search(e=""){try{if(this.loader=!0,e=="")return this.indexPaginates(),!0;const r=await documentSearch(e);return this.items=r.data,this.loader=!1,r.status?(this.loader=!1,!0):(u("error",this.$t("formError")),this.loader=!1,!1)}catch(r){return c(this,r),this.loader=!1,!1}},async delete(e){try{if(!confirm(this.$t("DeleteAlert")))return!1;if((await documentDelete(e)).status){this.indexPaginates(this.current_page),u("success",this.$t("delete"));return}return u("error",this.$t("formError")),!1}catch(r){return c(this,r),!1}}},mounted(){this.show(),this.showDocument(),this.indexPaymentTypes()}},be={class:"row"},ge={class:"m-0",style:{"text-wrap":"wrap"}},we={class:"font-size-10 m-0",style:{"text-wrap":"wrap"}},Se={class:"w-100 d-flex justify-content-end"},Pe={class:"col-xl-5"},Me={class:"card"},Be={class:"card-body"},Ie={class:"table-responsive"},Te={class:"table table-nowrap mb-0"},Ce={scope:"row"},$e={scope:"row"},Le=t("br",null,null,-1);function Ne(e,r,h,a,s,p){const S=i("Header"),P=i("PrimaryIconBtn"),M=i("GrowingLoader"),B=i("BasicTable"),I=i("ToPay"),T=i("PrimaryModalBtn"),C=i("BtnBox"),b=i("DefaultInput"),$=i("ModalCentered"),L=i("toPay"),N=i("Page");return l(),_(N,{Title:e.$t("RegistrationImportedDrugs"),Links:[{path:"/admin/documents",name:e.$t("ImportDocuments"),status:!1},{path:"/",name:e.$t("RegistrationMedicines"),status:!0}]},{default:m(()=>[t("div",be,[d(S,{document:s.document},null,8,["document"]),d(B,{Th:[e.$t("No"),e.$t("Picture"),e.$t("ModalName"),e.$t("Batch"),e.$t("ExpiryDateFinished"),e.$t("BoxSize"),e.$t("BuyPrice"),e.$t("PurchasedAmount"),e.$t("CurrentAmount"),e.$t("Subtotal"),e.$t("Settings")],Title:"",Col:"col-lg-12"},{default:m(()=>[(l(!0),f(j,null,U(s.medicines,(o,D)=>(l(),f("tr",null,[t("td",null,n(D+1),1),t("td",null,[t("div",{class:"table_image",style:q("background-image: url("+o.medicine.image[0].url+")")},null,4)]),t("td",null,[t("p",ge,n(o.medicine.name),1),t("p",we,n(o.medicine.generic_name),1)]),t("td",null,n(o.batch_name),1),t("td",null,n(o.expiry_date_finished),1),t("td",null,n(o.box_size.name),1),t("td",null,n(a.counterStore.formatNumber(o.buy_price))+" "+n(o.currency.sign),1),t("td",null,n(a.counterStore.formatNumber(o.amount)),1),t("td",null,n(a.counterStore.formatNumber(o.current_amount)),1),t("td",null,n(a.counterStore.formatNumber(o.total_cost))+" "+n(o.currency.sign),1),t("td",null,[o.amount!=0?(l(),_(P,{key:0,Modal:"returnedModal",onClick:De=>this.item=o,title:e.$t("UploadMedicine"),Icon:"bx bx-upload"},null,8,["onClick","title"])):y("",!0)])]))),256)),s.loader?(l(),_(M,{key:0,Cols:"11"})):y("",!0)]),_:1},8,["Th"]),d(I),t("div",Se,[t("div",Pe,[t("div",Me,[t("div",Be,[t("div",Ie,[t("table",Te,[t("tbody",null,[t("tr",null,[t("th",Ce,n(e.$t("Subtotal"))+" :",1),t("td",null,n(a.counterStore.formatNumber(s.document.subtotal))+" "+n(a.counterStore.user.currency.sign),1)]),t("tr",null,[t("th",$e,n(e.$t("AmountToPaid"))+" :",1),t("td",null,n(a.counterStore.formatNumber(s.document.loan_amount))+" "+n(a.counterStore.user.currency.sign),1)])])])]),Le,d(C,null,{default:m(()=>[s.document.loan_amount>0?(l(),_(T,{key:0,Modal:"documentToPayModal",Loader:s.loader},{default:m(()=>[J(n(e.$t("ToPay")),1)]),_:1},8,["Loader"])):y("",!0)]),_:1})])])])])]),d($,{ModalName:"returnedModal",Title:e.$t("UploadMedicine"),onOnModal:r[2]||(r[2]=o=>p.returnedMedicine())},{default:m(()=>[d(b,{Label:e.$t("ReturnedMedicineAmount")+" ("+e.$t("Maximum")+": "+s.item.amount+")",Name:"returned_amount",Type:"number",Max:s.item.current_amount,Validated:s.errors,Value:s.amount,onOnInput:r[0]||(r[0]=o=>(s.amount=o,delete this.errors.returned_amount))},null,8,["Label","Max","Validated","Value"]),d(b,{Label:e.$t("Qancha pul qaytarib olindi")+" ("+e.$t("Maximum")+": "+a.counterStore.formatNumber(s.document.amount_paid)+" "+s.sign+")",Name:"returned_price",Type:"text",Validated:s.errors,Value:a.counterStore.formatNumber(this.returned_price),inputClass:"returned_price",onOnInput:r[1]||(r[1]=o=>(p.addPrice(o),delete this.errors.returned_price))},null,8,["Label","Validated","Value"])]),_:1},8,["Title"]),d(L,{Item:s.document,onOnPayment:r[3]||(r[3]=o=>p.showDocument()),paymentTypes:s.paymentTypes},null,8,["Item","paymentTypes"])]),_:1},8,["Title","Links"])}const Qe=w(ye,[["render",Ne]]);export{Qe as default};
