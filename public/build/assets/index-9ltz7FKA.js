import{a as T,b as N,P as B}from"./Page-4XnC08k8.js";import{_ as M,M as D,u as O,ah as q,I as d,ai as j,A as c,o as p,c as g,w as u,e as n,a,t as i,f as y,r as l,S as z,an as H,bB as K,c8 as Q,c9 as W,ca as X,c1 as Y,cb as Z,c3 as ee,c4 as te,b$ as re,c5 as se,cc as ae,c7 as ne,g as V,b as I,d as L,n as ie,F as w}from"./app-e-hkRfMH.js";import{a as U,B as oe}from"./BasicTable-ycGBBi3k.js";import{G as le}from"./GrowingLoader-n5uhokVF.js";import{P as ue}from"./PrimaryIconBtn-HrObfPKe.js";import{D as x}from"./DefaultInput-nO-G-v5V.js";import{D as A}from"./DefaultSelect-vsYjQnTI.js";import{I as $}from"./ImageInput-D0gHF8ac.js";import{P as de}from"./Paginate-rw2bL9E0.js";const me={components:{ImageInput:$,DefaultSelect:A,PrimaryBtn:T,BtnBox:U,ModalCentered:D,PrimaryButton:N,DefaultInput:x,Page:B},setup(){return{counterStore:O()}},props:{Item:Object},data(){return{items:[],item:[],paginateCount:10,column:"id",type:"desc",errors:[],passwordErrors:[],loader:!1,loaderPass:!1,name:"",address:"",phone:"",email:"",image:""}},methods:{async show(e){try{const t=await q(e);this.item=t.data,this.name=t.data.name,this.login=t.data.login,this.email=t.data.email,this.phone=t.data.phone,this.image=t.data.image[0].url}catch(t){d(this,t)}},save(e){this.item=e,this.name=e.name,this.address=e.address,this.email=e.email,this.phone=e.phone,this.image=e.image!=null?e.image[0].url:""},async update(){try{this.loader=!0;let e={name:this.name,phone:this.phone,address:this.address,email:this.email,image:this.image};const t=await j(this.Item.id,e);return t.status?(this.show(t.data.id),c("success",this.$t("update")),this.loader=!1,this.counterStore.hiddenModal("customerUpdate"),this.$emit("onUpdate",!0),!0):(this.errors=t.errors,c("error",this.$t("formError")),this.loader=!1,!1)}catch(e){return d(this,e),this.loader=!1,!1}}},watch:{Item:function(e,t){this.save(this.Item)}}},ce={class:"row"},he={class:"row"},pe={class:"row"},fe={type:"button",class:"btn btn-light","data-bs-dismiss":"modal"};function _e(e,t,_,f,r,m){const b=l("ImageInput"),h=l("DefaultInput"),v=l("BaseBox"),P=l("PrimaryBtn"),C=l("BtnBox"),S=l("ModalCentered");return p(),g(S,{Title:e.$t("Update"),ModalName:"customerUpdate",isModalFooter:!1},{default:u(()=>[n("div",ce,[a(v,{Col:"col-xl-12",Title:""},{default:u(()=>[a(b,{Title:e.$t("ProfilPhoto"),Name:"customerUpdateImage",onCustomerUpdateImage:t[0]||(t[0]=o=>(r.image=o,delete this.errors.image)),Validated:r.errors,Image:r.image},null,8,["Title","Validated","Image"]),n("div",he,[a(h,{Label:e.$t("Name"),Name:"name",Type:"text",Validated:r.errors,Value:r.name,onOnInput:t[1]||(t[1]=o=>(r.name=o,delete this.errors.name)),Class:"col-lg-6 col-sm-12"},null,8,["Label","Validated","Value"]),a(h,{Label:e.$t("Phone"),Name:"phone",Type:"text",Validated:r.errors,Value:r.phone,onOnInput:t[2]||(t[2]=o=>(r.phone=o,delete this.errors.phone)),Class:"col-lg-6 col-sm-12"},null,8,["Label","Validated","Value"])]),n("div",pe,[a(h,{Label:e.$t("Email"),Name:"email",Type:"text",Validated:r.errors,Value:r.email,onOnInput:t[3]||(t[3]=o=>(r.email=o,delete this.errors.email)),Class:"col-lg-6 col-sm-12"},null,8,["Label","Validated","Value"]),a(h,{Label:e.$t("Address"),Name:"address",Type:"text",Validated:r.errors,Value:r.address,onOnInput:t[4]||(t[4]=o=>(r.address=o,delete this.errors.address)),Class:"col-lg-6 col-sm-12"},null,8,["Label","Validated","Value"])])]),_:1}),a(C,null,{default:u(()=>[n("button",fe,i(e.$t("Close")),1),y("   "),a(P,{Loader:r.loader,onOnButton:t[5]||(t[5]=o=>m.update())},{default:u(()=>[y(i(e.$t("Save")),1)]),_:1},8,["Loader"])]),_:1})])]),_:1},8,["Title"])}const ge=M(me,[["render",_e]]),ye={components:{ImageInput:$,DefaultSelect:A,PrimaryBtn:T,BtnBox:U,ModalCentered:D,PrimaryButton:N,DefaultInput:x,Page:B},setup(){return{counterStore:O()}},props:{Item:Object},data(){return{items:[],item:[],paginateCount:10,column:"id",type:"desc",errors:[],passwordErrors:[],loader:!1,loaderPass:!1,name:"",address:"",phone:"",email:"",image:""}},methods:{async show(e){try{const t=await z(e);this.item=t.data,this.name=t.data.name,this.login=t.data.login,this.email=t.data.email,this.phone=t.data.phone,this.image=t.data.image[0].url}catch(t){d(this,t)}},async save(){try{this.item="",this.name="",this.address="",this.email="",this.phone="",this.image=""}catch(e){d(this,e)}},async create(){try{this.loader=!0;let e={name:this.name,phone:this.phone,address:this.address,email:this.email,image:this.image};const t=await H(e);return t.status?(c("success",this.$t("create")),this.save(),this.loader=!1,this.counterStore.hiddenModal("customerCreate"),this.$emit("onCreate",!0),!0):(this.errors=t.errors,c("error",this.$t("formError")),this.loader=!1,!1)}catch(e){return d(this,e),this.loader=!1,!1}}},mounted(){},watch:{Item:function(e,t){this.save()}}},be={class:"row"},Pe={class:"row"},Ce={class:"row"},Ve={type:"button",class:"btn btn-light","data-bs-dismiss":"modal"};function Ie(e,t,_,f,r,m){const b=l("ImageInput"),h=l("DefaultInput"),v=l("BaseBox"),P=l("PrimaryBtn"),C=l("BtnBox"),S=l("ModalCentered");return p(),g(S,{Title:e.$t("Create"),ModalName:"customerCreate",isModalFooter:!1},{default:u(()=>[n("div",be,[a(v,{Col:"col-xl-12",Title:""},{default:u(()=>[a(b,{Title:e.$t("ProfilPhoto"),Name:"customerCreateImage",onCustomerCreateImage:t[0]||(t[0]=o=>(r.image=o,delete this.errors.image)),Validated:r.errors},null,8,["Title","Validated"]),n("div",Pe,[a(h,{Label:e.$t("Name"),Name:"name",Type:"text",Validated:r.errors,Value:r.name,onOnInput:t[1]||(t[1]=o=>(r.name=o,delete this.errors.name)),Class:"col-lg-6 col-sm-12"},null,8,["Label","Validated","Value"]),a(h,{Label:e.$t("Phone"),Name:"phone",Type:"text",Validated:r.errors,Value:r.phone,onOnInput:t[2]||(t[2]=o=>(r.phone=o,delete this.errors.phone)),Class:"col-lg-6 col-sm-12"},null,8,["Label","Validated","Value"])]),n("div",Ce,[a(h,{Label:e.$t("Email"),Name:"email",Type:"text",Validated:r.errors,Value:r.email,onOnInput:t[3]||(t[3]=o=>(r.email=o,delete this.errors.email)),Class:"col-lg-6 col-sm-12"},null,8,["Label","Validated","Value"]),a(h,{Label:e.$t("Address"),Name:"address",Type:"text",Validated:r.errors,Value:r.address,onOnInput:t[4]||(t[4]=o=>(r.address=o,delete this.errors.address)),Class:"col-lg-6 col-sm-12"},null,8,["Label","Validated","Value"])])]),_:1}),a(C,null,{default:u(()=>[n("button",Ve,i(e.$t("Close")),1),y("   "),a(P,{Loader:r.loader,onOnButton:t[5]||(t[5]=o=>m.create())},{default:u(()=>[y(i(e.$t("Save")),1)]),_:1},8,["Loader"])]),_:1})])]),_:1},8,["Title"])}const ve=M(ye,[["render",Ie]]),Se={components:{DefaultSelect:A,Paginate:de,DefaultInput:x,PrimaryBtn:T,ModalCentered:D,PrimaryIconBtn:ue,PrimaryButton:N,GrowingLoader:le,BasicTable:oe,Page:B,Update:ge,Create:ve},setup(){return{counterStore:O()}},data(){return{items:[],item:[],paginateCount:10,last_page:1,current_page:1,column:"id",type:"desc",errors:[],loader:!1,startDate:null,finishDate:null,isSearch:!1,medicines:[],return_amount:0,max_amount:0,sign:"",returnLoader:!1,medicine_id:0,return_price:0,max_price:0,return_medicine:[],payment_type_id:null,paymentTypes:[],paymentLoader:!1}},methods:{async indexPaymentTypes(){try{const e=await K();this.paymentTypes=e.data}catch(e){d(this,e)}},calculatePrice(){let e=this.return_medicine.one_sum*this.return_amount;this.max_price>=e?this.return_price=e:this.return_price=this.max_price},returnPrice(e){let t=this.counterStore.inputNumberFormat("returnPrice",this.return_price,e);this.return_price=t},returnAmount(e){let t=e,_=document.querySelector(".returnAmount");e>this.max_amount&&(t=this.return_amount,c("error",this.$t("ReturnAllValidator"))),_.value=t,this.return_amount=t,this.calculatePrice()},refreshData(){this.medicine_id=null,this.invoice_id=null,this.customer_id=null,this.return_amount=0,this.return_price=0,this.return_medicine=[],this.max_price=0,this.max_amount=0},async toPay(){try{if(this.return_price<0||this.return_price>this.item.subtotal){this.errors.return_price=this.$t("ReturnedMaxError2"),this.return_price=this.item.subtotal;return}this.paymentLoader=!0;let e={payment_type_id:this.payment_type_id,invoice_id:this.item.id,amount:this.return_price};const t=await Q(e);return t.status?(this.counterStore.hiddenModal("paymentInvoice"),c("success",this.$t("create")),this.indexPaginates(),this.item=[],this.errors=[],this.return_price=0,this.invoice_id=null,this.paymentLoader=!1,!0):(this.errors=t.errors,c("error",this.$t("formError")),this.paymentLoader=!1,!1)}catch(e){return d(this,e),!1}},async returnMedicine(){try{if(this.medicine_id==0){this.errors.medicine_id=this.$t("MedicineRequired");return}if((this.return_amount<0||this.return_amount<1)&&(this.return_amount=0),this.return_price>this.max_price){this.errors.return_price=this.$t("ReturnedMaxError2");return}let e={sold_medicine_id:this.medicine_id,invoice_id:this.item.id,customer_id:this.item.customer_id,return_amount:this.return_amount,return_price:this.return_price};const t=await W(e);return console.log(e),t.status?(this.counterStore.hiddenModal("returnMedicine"),c("success",this.$t("create")),this.indexPaginates(),this.refreshData(),this.returnLoader=!1,!0):(this.errors=t.errors,c("error",this.$t("formError")),this.returnLoader=!1,!1)}catch(e){return d(this,e),!1}},async index(){try{const e=await X();this.items=e.data}catch(e){d(this,e)}},async indexActives(){try{const e=await Y(this.paginateCount);this.items=e.data}catch(e){d(this,e)}},async indexPaginates(e=1){try{this.loader=!0,this.isSearch=!1;const t=await Z(this.paginateCount,e);this.current_page=t.data.pagination.current_page,this.last_page=t.data.pagination.last_page,this.items=t.data.items,this.loader=!1}catch(t){d(this,t)}},async orderBys(){try{const e=await ee(this.column,this.type);this.items=e.data}catch(e){d(this,e)}},async show(e){try{this.returnLoader=!0;const t=await te(e);this.item=t.data,this.medicines=t.data.sold_medicines,this.max_amount=this.medicines[0].amount,this.max_price=t.data.amount_paid,this.medicine_id=this.medicines[0].id,this.return_medicine=this.medicines[0],this.sign=t.data.currency.sign,this.returnLoader=!1}catch(t){d(this,t)}},async create(){try{const t=await re({});return t.status?(c("success",this.$t("create")),!0):(this.errors=t.errors,c("error",this.$t("formError")),!1)}catch(e){return d(this,e),!1}},async update(){try{const t=await se({});return t.status?(c("success",this.$t("update")),!0):(this.errors=t.errors,c("error",this.$t("formError")),!1)}catch(e){return d(this,e),!1}},async search(e=1){try{this.loader=!0;let t={start:this.startDate,finish:this.finishDate};this.isSearch=!0;const _=await ae(t,e);return this.items=_.data.items,this.current_page=_.data.pagination.current_page,this.last_page=_.data.pagination.last_page,this.loader=!1,_.status?(this.loader=!1,!0):(c("error",this.$t("formError")),this.loader=!1,!1)}catch(t){return d(this,t),this.loader=!1,!1}},async delete(e){try{if(!confirm(this.$t("DeleteAlert")))return!1;const t=await ne(e);return this.items=t.data,t.status&&(this.indexPaginates(this.current_page),c("success",this.$t("delete"))),c("error",this.$t("formError")),!1}catch(t){return d(this,t),!1}}},mounted(){this.indexPaginates(),this.indexPaymentTypes()}},Le={class:"row"},we={value:"10",selected:""},Te=n("option",{value:"10"},"10",-1),Ne=n("option",{value:"20"},"20",-1),Be=n("option",{value:"50"},"50",-1),Me=n("option",{value:"100"},"100",-1),De=["value"],Oe=n("option",{value:""},"---",-1),xe=["value"];function Ae(e,t,_,f,r,m){const b=l("DefaultSelect"),h=l("DefaultInput"),v=l("PrimaryBtn"),P=l("PrimaryIconBtn"),C=l("Paginate"),S=l("GrowingLoader"),o=l("BasicTable"),R=l("Update"),F=l("Create"),E=l("ModalCentered"),G=l("Page");return p(),g(G,{Title:""},{default:u(()=>[n("div",Le,[a(o,{Th:[e.$t("No"),e.$t("Date"),e.$t("Identifikator"),e.$t("Customer"),e.$t("Seller"),e.$t("Amount"),e.$t("Subtotal")+"+"+e.$t("VatSign"),e.$t("Paid"),e.$t("Indebtedness"),e.$t("Settings")],Title:e.$t("SellingArxive"),Col:"col-lg-12"},{inputs:u(()=>[a(b,{Label:"",Class:"col-lg-2 col-sm-2",onOnInput:t[0]||(t[0]=s=>(this.paginateCount=s,this.indexPaginates()))},{default:u(()=>[n("option",we,i(e.$t("NumberDownloads")),1),Te,Ne,Be,Me]),_:1}),y("   "),a(h,{Class:"col-lg-3 col-sm-2 search_input",Label:"",Name:"start",Type:"date",onOnInput:t[1]||(t[1]=s=>(r.startDate=s,m.search()))}),a(h,{Class:"col-lg-3 col-sm-2 search_input",Label:"",Name:"finish",Type:"date",onOnInput:t[2]||(t[2]=s=>(r.finishDate=s,m.search()))})]),buttons:u(()=>[f.counterStore.hasRole("invoices-create")?(p(),g(v,{key:0,role:"button","data-bs-toggle":"modal","data-bs-target":"#invoiceCreate"},{default:u(()=>[y(i(e.$t("Create")),1)]),_:1})):V("",!0)]),default:u(()=>[(p(!0),I(w,null,L(r.items,(s,J)=>(p(),I("tr",null,[n("td",null,i((r.current_page-1)*r.paginateCount+J+1),1),n("td",null,i(s.date),1),n("td",null,"#"+i(s.id),1),n("td",null,i(s.customer.name),1),n("td",null,i(s.user.name),1),n("td",null,i(f.counterStore.formatNumber(s.amount)),1),n("td",null,i(f.counterStore.formatNumber(s.subtotal))+" "+i(s.currency.sign),1),n("td",null,i(f.counterStore.formatNumber(s.amount_paid))+" "+i(s.currency.sign),1),n("td",{class:ie(s.must_paid>0?"text-danger":"")},i(f.counterStore.formatNumber(s.must_paid))+" "+i(s.currency.sign),3),n("td",null,[a(P,{onClick:k=>this.$router.push({path:"/admin/invoices/show",query:{id:s.id}}),Icon:"bx bx-show"},null,8,["onClick"]),f.counterStore.hasRole("Selling-update")&&(s.subtotal>0||s.amount_paid>0)?(p(),g(P,{key:0,onClick:k=>m.show(s.id),Modal:"returnMedicine",class:"bg-info border-info",Icon:"bx bx-rotate-left",title:e.$t("ReturnMedicines")},null,8,["onClick","title"])):V("",!0),f.counterStore.hasRole("Selling-update")&&s.subtotal>s.amount_paid?(p(),g(P,{key:1,onClick:k=>(this.item=s,r.max_price=s.must_paid),Modal:"paymentInvoice",class:"bg-success border-success",Icon:"bx bx-money",title:e.$t("ToPay")},null,8,["onClick","title"])):V("",!0)])]))),256)),r.last_page!=1&&!r.isSearch?(p(),g(C,{key:0,Cols:"10",currentPage:this.current_page,totalPages:this.last_page,onChangePage:t[3]||(t[3]=s=>m.indexPaginates(s))},null,8,["currentPage","totalPages"])):V("",!0),r.last_page!=1&&r.isSearch?(p(),g(C,{key:1,Cols:"10",currentPage:this.current_page,totalPages:this.last_page,onChangePage:t[4]||(t[4]=s=>m.search(s))},null,8,["currentPage","totalPages"])):V("",!0),r.loader?(p(),g(S,{key:2,Cols:"10"})):V("",!0)]),_:1},8,["Th","Title"])]),a(R,{Item:r.item,onOnUpdate:t[5]||(t[5]=s=>m.indexPaginates(this.current_page))},null,8,["Item"]),a(F,{onOnCreate:t[6]||(t[6]=s=>m.indexPaginates(this.current_page))}),a(E,{ModalName:"returnMedicine",Title:e.$t("MedicineReturn"),onOnModal:t[10]||(t[10]=s=>m.returnMedicine()),isDisabled:r.returnLoader},{default:u(()=>[a(b,{Label:e.$t("Medicine")+" ("+e.$t("Price")+"+"+e.$t("VatSign")+"+"+e.$t("Gst")+")",Name:"medicine_id",Validated:r.errors,onOnInput:t[7]||(t[7]=s=>(r.return_medicine=JSON.parse(s),r.max_amount=JSON.parse(s).amount,r.medicine_id=JSON.parse(s).id,delete this.errors.medicine_id))},{default:u(()=>[(p(!0),I(w,null,L(r.medicines,s=>(p(),I("option",{value:JSON.stringify(s)},i(s.name)+" ( "+i(e.$t("PC"))+": "+i(s.amount)+" ) "+i(f.counterStore.formatNumber(s.one_sum*s.amount))+" "+i(r.sign),9,De))),256))]),_:1},8,["Label","Validated"]),y("   "),a(h,{Label:e.$t("Amount")+" ("+e.$t("Total")+": "+r.max_amount+" )",Name:"return_amount",Type:"number",inputClass:"returnAmount",Value:r.return_amount,Validated:r.errors,onOnInput:t[8]||(t[8]=s=>(m.returnAmount(s),delete this.errors.return_amount))},null,8,["Label","Value","Validated"]),a(h,{Label:e.$t("ReturnPriceValidator")+" ("+e.$t("Maximum")+": "+f.counterStore.formatNumber(r.max_price)+" "+r.sign+" )",Name:"return_price",Type:"text",inputClass:"returnPrice",Value:f.counterStore.formatNumber(this.return_price),Validated:r.errors,onOnInput:t[9]||(t[9]=s=>(m.returnPrice(s),delete this.errors.return_price))},null,8,["Label","Value","Validated"])]),_:1},8,["Title","isDisabled"]),a(E,{ModalName:"paymentInvoice",Title:e.$t("ToPay"),onOnModal:t[13]||(t[13]=s=>m.toPay()),isDisabled:r.paymentLoader},{default:u(()=>[a(h,{Label:e.$t("EnterPaymentAmount")+" ("+e.$t("Indebtedness")+": "+f.counterStore.formatNumber(r.max_price)+" "+r.sign+" )",Name:"return_price",Type:"text",inputClass:"returnPrice",Value:f.counterStore.formatNumber(this.return_price),Validated:r.errors,onOnInput:t[11]||(t[11]=s=>(m.returnPrice(s),delete this.errors.return_price))},null,8,["Label","Value","Validated"]),a(b,{Label:e.$t("PaymentType"),Name:"payment_type_id",Validated:r.errors,onOnInput:t[12]||(t[12]=s=>(r.payment_type_id=s,delete this.errors.payment_type_id))},{default:u(()=>[Oe,(p(!0),I(w,null,L(r.paymentTypes,s=>(p(),I("option",{value:s.id},i(s.name),9,xe))),256))]),_:1},8,["Label","Validated"]),y("   ")]),_:1},8,["Title","isDisabled"])]),_:1})}const je=M(Se,[["render",Ae]]);export{je as default};
