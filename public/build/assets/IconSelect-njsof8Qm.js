import{_ as g,u as I,o as l,b as d,e as t,t as r,n as y,g as _,A as f,bU as P,J as B,bC as k,a as m,w as h,i as b,F as $,d as C,r as c,H as T,bV as L,a0 as M,c as A,j as N}from"./app-kSgaNykg.js";import{a as V}from"./BasicTable-Nqtvmjvc.js";import{a as x}from"./Page--fIEmjoW.js";import{D}from"./DefaultInput-MM8aozR4.js";import{D as E}from"./DefaultIconInput-Nkd_Bf4g.js";import{D as j}from"./DefaultSelect-O_x5q3GZ.js";import{G as O}from"./GrowingLoader-IUKqptmZ.js";const z={setup(){return{counterStore:I()}},props:{document:{type:[Array,Object],default:[]}}},F={class:"col-xl-12"},H={class:"card"},G={class:"card-body"},R={class:"table-responsive"},q={class:"table table-bordered mb-0"},J={key:0};function U(e,s,a,i,o,u){return l(),d("div",F,[t("div",H,[t("div",G,[t("div",R,[t("table",q,[t("thead",null,[t("tr",null,[t("th",null,r(e.$t("Id")),1),t("th",null,r(e.$t("Warehouse")),1),t("th",null,r(e.$t("Supplier")),1),t("th",null,r(e.$t("ImportedDate")),1),t("th",null,r(e.$t("Subtotal")),1),t("th",null,r(e.$t("AmountPaid")),1),t("th",null,r(e.$t("Indebtedness")),1),t("th",null,r(e.$t("Status")),1)])]),t("tbody",null,[a.document.length!=0?(l(),d("tr",J,[t("td",null," #"+r(a.document.id),1),t("td",null,r(a.document.warehouse.name),1),t("td",null,r(a.document.supplier.name),1),t("td",null,r(a.document.date),1),t("td",null,r(i.counterStore.formatNumber(a.document.subtotal))+" "+r(a.document.currency.sign),1),t("td",null,r(i.counterStore.formatNumber(a.document.amount_paid))+" "+r(a.document.currency.sign),1),t("td",null,r(i.counterStore.formatNumber(a.document.loan_amount))+" "+r(a.document.currency.sign),1),t("td",null,[t("span",{class:y([a.document.status==5?"badge-soft-success":"badge-soft-warning","badge badge-pill font-size-11"])},r(a.document.status==5?e.$t("Saved"):e.$t("NotSaved")),3)])])):_("",!0)])])])])])])}const Me=g(z,[["render",U]]),W={components:{DefaultSelect:j,DefaultIconInput:E,DefaultInput:D,PrimaryBtn:x,BtnBox:V},setup(){return{counterStore:I()}},props:{medicines:[Object,Array],document:[Object,Array],isChange:Boolean},data(){return{subtotal:0,errors:[],loader:!1,paid:0,paymentTypes:[],payment_type_id:null,dataErrors:[]}},methods:{validator(){let e=[];return this.medicines.forEach((s,a)=>{(s.batch_name==null||s.batch_name.length==0)&&e.push("batch"+s.sortId),(s.expiry_date_finished==null||this.isDateBeforeToday(s.expiry_date_finished))&&e.push("date"+s.sortId),this.isNumber(s.buy_price)||e.push("buy_price"+s.sortId),(!this.isNumber(s.buy_amount)||s.buy_amount<=0)&&e.push("buy_amount"+s.sortId)}),this.dataErrors=e,e.length>0||this.medicines==[]?(f("error",this.$t("formError")),!1):this.paid>this.subtotal?(f("error",this.$t("TheIncreased")),!1):this.paid>0&&this.payment_type_id<1?(f("error",this.$t("PaymentTyperequired")),!1):!0},isNumber(e){const s=parseFloat(e);return!isNaN(s)&&typeof s=="number"},isDateBeforeToday(e){const s=new Date(e),a=new Date;return a.setHours(0,0,0,0),s.setHours(0,0,0,0),s<=a},async save(){try{if(this.loader=!0,!this.validator())return this.$emit("dataErrors",this.dataErrors),this.loader=!1,!1;let e={document_id:this.document.id,supplier_id:this.document.supplier_id,warehouse_id:this.document.warehouse_id,payment_type_id:this.payment_type_id,amount_paid:this.paid,medicines:this.medicines,currency_id:this.counterStore.user.currency.id};console.log("Data:",e);const s=await P(e);return s.status?(f("success",this.$t("save")),this.loader=!1,this.$router.push("/admin/documents"),!0):(this.errors=s.errors,f("error",this.$t("formError")),this.loader=!1,!1)}catch(e){return B(this,e),this.loader=!1,!1}},report(){let e=0;this.medicines.forEach(s=>{e+=s.buy_price*s.buy_amount}),this.subtotal=e},addPrice(e){let s=this.counterStore.inputNumberFormat("reportPrice",this.paid,e);this.paid=s},async indexPaymentTypes(){try{this.loader=!0;const e=await k();this.paymentTypes=e.data,this.loader=!1}catch(e){B(this,e)}}},watch:{isChange:function(e,s){this.report()}},mounted(){this.indexPaymentTypes()}},K={class:"w-100 d-flex justify-content-end"},Q={class:"col-xl-5"},X={class:"card"},Y={class:"card-body"},Z={class:"table-responsive"},ee={class:"table table-nowrap mb-0"},te={scope:"row"},se={scope:"row"},re={scope:"row"},ae={scope:"row"},ne=t("option",{selected:"",value:0},"---",-1),oe=["value"],le=t("br",null,null,-1);function ie(e,s,a,i,o,u){const p=c("DefaultIconInput"),S=c("DefaultSelect"),v=c("PrimaryBtn"),w=c("BtnBox");return l(),d("div",K,[t("div",Q,[t("div",X,[t("div",Y,[t("div",Z,[t("table",ee,[t("tbody",null,[t("tr",null,[t("th",te,r(e.$t("Subtotal"))+" :",1),t("td",null,r(i.counterStore.formatNumber(o.subtotal.toFixed(2)))+" "+r(i.counterStore.user.currency.sign),1)]),t("tr",null,[t("th",se,r(e.$t("AmountToPaid"))+" :",1),t("td",null,r(i.counterStore.formatNumber(o.subtotal.toFixed(2)))+" "+r(i.counterStore.user.currency.sign),1)]),t("tr",null,[t("th",re,r(e.$t("Paid"))+" :",1),t("td",null,[m(p,{DefaultIconInput:"",Label:"",Name:"amount_paid",Type:"text",Validated:o.errors,onOnInput:s[0]||(s[0]=n=>(u.addPrice(n),delete this.errors.amount_paid)),inputClass:"reportPrice",Value:i.counterStore.formatNumber(o.paid)},{default:h(()=>[b(r(i.counterStore.user.currency.sign),1)]),_:1},8,["Validated","Value"])])]),t("tr",null,[t("th",ae,r(e.$t("PaymentType"))+" :",1),t("td",null,[m(S,{Label:"",Name:"payment_type_id",Validated:o.errors,Value:o.payment_type_id,onOnInput:s[1]||(s[1]=n=>(o.payment_type_id=n,delete this.errors.payment_type_id))},{default:h(()=>[ne,(l(!0),d($,null,C(o.paymentTypes,n=>(l(),d("option",{value:n.id},r(n.name),9,oe))),256))]),_:1},8,["Validated","Value"])])])])])]),le,m(w,null,{default:h(()=>[m(v,{Loader:o.loader,onClick:s[2]||(s[2]=n=>u.save())},{default:h(()=>[b(r(e.$t("Save")),1)]),_:1},8,["Loader"])]),_:1})])])])])}const Ae=g(W,[["render",ie]]),de={components:{GrowingLoader:O,BtnBox:V,BaseBox:T,DefaultInput:D,PrimaryBtn:x},props:{tableMedicines:Object,isChange:Object},watch:{isChange:function(e,s){console.log("oke",this.tableMedicines),this.medicines=this.medicines.filter(a=>a.id!=this.isChange)}},setup(){return{counterStore:I()}},data(){return{items:[],loader:!1,medicines:[]}},methods:{hasMedicines(e){return!!this.medicines.find(a=>a.id==e.id)},addMedicines(e){this.medicines.push(e),this.$emit("onAdd",e)},async search(e=""){try{this.loader=!0;const s=await L(e);return this.items=s.data,this.loader=!1,s.status?(this.loader=!1,!0):(Alert("error",this.$t("formError")),this.loader=!1,!1)}catch(s){return B(this,s),this.loader=!1,!1}}}},ue={class:"w-100 d-flex mb-2"},ce={class:"col-5",style:{"z-index":"100"}},me={class:"dropdown"},he={class:"dropdown-menu col-lg-12 col-sm-12","aria-labelledby":"dropdownMenuButton",style:{"z-index":"1000"}},_e=["onClick"],pe={class:"d-flex justify-content-center flex-column search_item"},fe={class:"search_p"},ye={class:"search_p_2",style:{"text-wrap":"wrap"}},be={key:0,class:"dropdown-item d-flex justify-content-center"};function ge(e,s,a,i,o,u){const p=c("DefaultInput"),S=c("GrowingLoader"),v=c("PrimaryBtn"),w=c("BtnBox");return l(),d("div",ue,[t("div",ce,[t("div",me,[m(p,{id:"dropdownMenuButton","data-bs-toggle":"dropdown","aria-expanded":"false",Class:"col-lg-12 col-sm-12   search_input",Label:"",Name:"name",Type:"text",Pholder:e.$t("SearchMedicines"),onOnInput:s[0]||(s[0]=n=>u.search(n))},null,8,["Pholder"]),t("div",he,[(l(!0),d($,null,C(o.items,n=>(l(),d("a",{class:y(["dropdown-item d-flex align-items-center",u.hasMedicines(n)?"bg-success-subtle":""]),onClick:Ce=>u.addMedicines(n)},[t("div",{class:"table_image search_medicines_img",style:M("background-image: url("+n.image[0].url+")")},null,4),t("div",pe,[t("p",fe,r(n.name)+" ("+r(n.drug_company)+")",1),t("p",ye,r(n.generic_name),1)])],10,_e))),256)),o.loader?(l(),d("a",be,[m(S)])):_("",!0)])])]),m(w,null,{default:h(()=>[i.counterStore.hasRole("Medicines-create")?(l(),A(v,{key:0,role:"button","data-bs-toggle":"modal","data-bs-target":"#medicineCreate"},{default:h(()=>[b(r(e.$t("CreateMedicine")),1)]),_:1})):_("",!0)]),_:1})])}const Ee=g(de,[["render",ge]]),Se={props:{isButton:{type:Boolean,default:!1},Class:{type:String,default:"col-lg-12 col-sm-12"},ModalName:{type:String,default:"modal"},Name:{type:[String],default:""},Label:{type:String,default:"Label title"},Pholder:{type:String,default:"enter here..."},Type:{type:String,default:"text"},Value:{type:[String,Number],default:""},Validated:{type:[Array,Object,String],default:[]}}},ve={key:0,class:"form-label"},we=["data-bs-target"],Be={class:"input-group",id:"timepicker-input-group1"},Ie={class:"input-group-text"},Ne={key:1,class:"form-label text-danger"};function $e(e,s,a,i,o,u){return l(),d("div",{class:y(a.Class)},[t("div",null,[a.Label!=""?(l(),d("label",ve,[b(r(a.Label)+" ",1),a.isButton?(l(),d("a",{key:0,class:"btn btn-primary waves-effect waves-light",role:"button","data-bs-toggle":"modal","data-bs-target":"#"+a.ModalName,style:{padding:"0px 5px","font-size":"10px"}},r(e.$t("Create")),9,we)):_("",!0)])):_("",!0),t("div",Be,[t("select",{class:y(["form-select",a.Validated[a.Name]?"border-danger":""]),onInput:s[0]||(s[0]=p=>this.$emit("onInput",p.target.value))},[N(e.$slots,"default")],34),t("span",Ie,[N(e.$slots,"icon")])]),a.Validated[a.Name]?(l(),d("p",Ne,r(a.Validated[a.Name]),1)):_("",!0)])],2)}const je=g(Se,[["render",$e]]);export{Me as H,je as I,Ae as R,Ee as S};
